var startNumber=501;var doubleOut=true;var players=new Array();var currentPlayer=0;var numberOfWinners=0;var numberOfExchangeButtons=0;var playedRounds=1;var oldScore=0;var oldAvg=0;var timesOfUndo=0;var numberOfPlayers=0;var hasLastWon=false;var nameLastWon="";var numberPlayerHasWon=0;var nameLost="";var avgLost=0;var oldScoreLast=0;document.getElementById("score").addEventListener("keyup",function(a){a.preventDefault();if(a.keyCode==13){document.getElementById("next").click()}});$(".number").on("click",function(){var a=($(this)[0].firstChild.nodeValue);document.getElementById("score").value+=a});$("#rmv").on("click",function(){var a=document.getElementById("score").value;document.getElementById("score").value=a.substring(0,a.length-1)});$("#quit").on("click",function(){clearSessionStorage();window.location.href="./counterSettings.html"});$("#restart").on("click",function(){currentPlayer=0;numberOfWinners=0;numberOfExchangeButtons=0;playedRounds=1;oldScore=0;oldAvg=0;timesOfUndo=0;numberOfPlayers=players.length;document.getElementById("score").value="";clearRemainingPlayerList();createPlayerList();fillNamesInList();for(var a=0;a<players.length;a++){document.getElementsByName("avg")[a].innerHTML="";document.getElementsByName("playerScore")[a].innerHTML=startNumber;document.getElementsByName("player")[a].style.opacity=0.5;document.getElementsByName("nameWinner")[a].innerHTML="";document.getElementsByName("average")[a].innerHTML=""}document.getElementsByName("player")[0].style.opacity=1;document.getElementsByName("avg")[0].style.display="initial";document.getElementById("score").focus();document.getElementById("currentRound").innerText=playedRounds});$("#next").on("click",function(){timesOfUndo=0;hasLastWon=false;var e=document.getElementById("score").value;if(e==""){e=0}if(!isInt(e)){alert("Please enter a natural number.")}else{if(e>180){alert("Please enter a score of 180 or less.")}else{if(document.getElementsByName("player").length===0){alert("Please start a new Game!")}else{try{document.getElementById("score").value="";var c=document.getElementsByName("playerScore")[currentPlayer].innerHTML;oldAvg=document.getElementsByName("avg")[currentPlayer].innerHTML;oldScore=c;var f=c-e;if(f<0){var b=roundToTwo((startNumber-c)/playedRounds);document.getElementsByName("avg")[currentPlayer].innerHTML=b;nextPlayer()}else{if(f===1&&doubleOut){var b=roundToTwo((startNumber-c)/playedRounds);document.getElementsByName("avg")[currentPlayer].innerHTML=b;nextPlayer()}else{if(f===0){var d=roundToTwo(startNumber/playedRounds);hasLastWon=true;nameLastWon=document.getElementsByName("playerName")[currentPlayer].innerHTML;numberPlayerHasWon=currentPlayer;addPlayerToTable(d);removePlayer();numberOfPlayers=numberOfPlayers-1}else{document.getElementsByName("playerScore")[currentPlayer].innerHTML=f;var b=roundToTwo((startNumber-f)/playedRounds);document.getElementsByName("avg")[currentPlayer].innerHTML=b;removeExchangeButtons();nextPlayer()}}}}catch(a){alert("An error occured. Player 1 to throw now. Sorry for any inconvenience caused.");console.log(a);document.getElementsByName("player")[currentPlayer].style.opacity=0.5;currentPlayer=0;document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial"}}}}});$("#undo").on("click",function(){if(timesOfUndo!=0){alert("Only one time 'Undo' allowed!")}else{if(!hasLastWon){undo()}else{undoLastHasWon()}timesOfUndo=1}});function parseFromSessionStorage(a){return JSON.parse(window.sessionStorage.getItem(a))}function clearSessionStorage(){return window.sessionStorage.clear()}function init(){if(sessionStorage.length===0){window.location.href="./counterSettings.html"}var a;startNumber=parseFromSessionStorage("startNumber");doubleOut=parseFromSessionStorage("doubleOut");players=parseFromSessionStorage("players");if(startNumber==null&&doubleOut==null){startNumber=501;doubleOut=true}else{if(doubleOut==null){doubleOut=true}else{if(startNumber==null){startNumber=501}}}if(doubleOut==true){a="Double Out"}else{a="Single Out"}numberOfPlayers=players.length;document.getElementById("startnumber").innerText=startNumber;document.getElementById("out").innerText=a;document.getElementById("currentRound").innerText=playedRounds;createPlayerList();fillNamesInList();createTable();document.getElementsByName("player")[0].style.opacity=1;document.getElementById("score").focus()}function createPlayerList(){var e=document.getElementById("players");for(var c=0;c<players.length;c++){var h=document.createElement("div");h.className="panel panel-default";h.setAttribute("name","player");var d=document.createElement("div");d.className="panel-heading";d.setAttribute("name","playerName");var f=document.createElement("div");f.className="panel-body";var g=document.createElement("p");g.setAttribute("name","playerScore");var b=document.createElement("p");b.innerHTML="Average: ";var a=document.createElement("span");a.setAttribute("name","avg");b.appendChild(a);f.appendChild(g);f.appendChild(b);h.appendChild(d);h.appendChild(f);e.appendChild(h);if((c+1)!==players.length){createExchangeButtons(e)}}}function fillNamesInList(){for(var a=0;a<players.length;a++){document.getElementsByName("playerName")[a].innerHTML=players[a];document.getElementsByName("playerScore")[a].innerHTML=startNumber;document.getElementsByName("player")[a].style.opacity=0.5}}function isInt(a){return !isNaN(a)&&parseInt(Number(a))==a&&!isNaN(parseInt(a,10))&&a>=0}function nextPlayer(){document.getElementsByName("player")[currentPlayer].style.opacity=0.5;if(currentPlayer<document.getElementsByName("player").length-1){currentPlayer=currentPlayer+1;document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial"}else{currentPlayer=0;playedRounds=playedRounds+1;document.getElementById("currentRound").innerText=playedRounds;document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial"}}function undo(){if(currentPlayer==0){if((playedRounds-1)<=0){alert("Don't abuse the Undo Button!")}else{playedRounds=playedRounds-1;document.getElementsByName("player")[currentPlayer].style.opacity=0.5;currentPlayer=(numberOfPlayers-1);document.getElementById("currentRound").innerText=playedRounds;document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial";document.getElementsByName("playerScore")[currentPlayer].innerHTML=oldScore;document.getElementsByName("avg")[currentPlayer].innerHTML=oldAvg;document.getElementById("score").focus()}}else{document.getElementsByName("player")[currentPlayer].style.opacity=0.5;currentPlayer=currentPlayer-1;document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial";document.getElementsByName("playerScore")[currentPlayer].innerHTML=oldScore;document.getElementsByName("avg")[currentPlayer].innerHTML=oldAvg;document.getElementById("score").focus()}}function undoLastHasWon(){var e=document.getElementById("players");var h=document.createElement("div");h.className="panel panel-default";h.setAttribute("name","player");var d=document.createElement("div");d.className="panel-heading";d.setAttribute("name","playerName");d.innerHTML=nameLastWon;var f=document.createElement("div");f.className="panel-body";var g=document.createElement("p");g.setAttribute("name","playerScore");g.innerHTML=oldScore;var c=document.createElement("p");c.innerHTML="Average: ";var a=document.createElement("span");a.setAttribute("name","avg");a.innerHTML=oldAvg;c.appendChild(a);f.appendChild(g);f.appendChild(c);h.appendChild(d);h.appendChild(f);console.log(numberPlayerHasWon);console.log(numberOfPlayers);if(numberPlayerHasWon===(numberOfPlayers-1)&&(players.length!=1)){numberOfPlayers=numberOfPlayers+1;document.getElementsByName("player")[currentPlayer].style.opacity=0.5;currentPlayer=(numberOfPlayers-1);playedRounds=playedRounds-1;document.getElementById("currentRound").innerText=playedRounds;e.appendChild(h);document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial";numberOfWinners=numberOfWinners-1;document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="";document.getElementsByName("average")[numberOfWinners].innerHTML=""}else{if(players.length==1){numberOfPlayers=numberOfPlayers+1;currentPlayer=0;playedRounds=playedRounds-1;document.getElementById("currentRound").innerText=playedRounds;e.appendChild(h);document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial";numberOfWinners=numberOfWinners-1;document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="";document.getElementsByName("average")[numberOfWinners].innerHTML=""}else{if(numberOfWinners==players.length){numberOfPlayers=numberOfPlayers+2;numberOfWinners=numberOfWinners-2;var b=h.cloneNode(true);e.appendChild(h);e.appendChild(b);if(numberPlayerHasWon==0){document.getElementsByName("playerName")[1].innerHTML=nameLost;document.getElementsByName("playerScore")[1].innerHTML=oldScoreLast;document.getElementsByName("avg")[1].innerHTML=avgLost;document.getElementsByName("player")[1].style.opacity=0.5;currentPlayer=0}else{document.getElementsByName("playerName")[0].innerHTML=nameLost;document.getElementsByName("playerScore")[0].innerHTML=oldScoreLast;document.getElementsByName("avg")[0].innerHTML=avgLost;document.getElementsByName("player")[0].style.opacity=0.5;currentPlayer=1}document.getElementsByName("player")[currentPlayer].style.opacity=1}else{numberOfPlayers=numberOfPlayers+1;document.getElementsByName("player")[currentPlayer].style.opacity=0.5;e.insertBefore(h,e.childNodes[currentPlayer]);document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial";numberOfWinners=numberOfWinners-1;document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="";document.getElementsByName("average")[numberOfWinners].innerHTML=""}}}}function removePlayer(){var a=document.getElementsByName("player")[currentPlayer];a.parentNode.removeChild(a);if(currentPlayer===document.getElementsByName("player").length){currentPlayer=0;playedRounds=playedRounds+1;document.getElementById("currentRound").innerText=playedRounds}if(document.getElementsByName("player").length>1){document.getElementsByName("player")[currentPlayer].style.opacity=1;document.getElementsByName("avg")[currentPlayer].style.display="initial"}if(document.getElementsByName("player").length===1){var b=document.getElementsByName("avg")[currentPlayer].innerHTML;oldScoreLast=document.getElementsByName("playerScore")[currentPlayer].innerHTML;nameLost=document.getElementsByName("playerName")[currentPlayer].innerHTML;avgLost=b;addPlayerToTable(b);a=document.getElementsByName("player")[currentPlayer];a.parentNode.removeChild(a);numberOfPlayers=numberOfPlayers-1}}function addPlayerToTable(b){var a=document.getElementsByName("playerName")[currentPlayer].innerHTML;document.getElementsByName("nameWinner")[numberOfWinners].innerHTML=a;document.getElementsByName("average")[numberOfWinners].innerHTML=b;numberOfWinners=numberOfWinners+1}function createTable(){var e=document.getElementById("table");for(var d=1;d<=players.length;d++){var a=document.createElement("tr");var b=document.createElement("td");var g=document.createTextNode(d);b.appendChild(g);var c=document.createElement("td");c.setAttribute("name","nameWinner");var f=document.createElement("td");f.setAttribute("name","average");a.appendChild(b);a.appendChild(c);a.appendChild(f);e.appendChild(a)}}function clearRemainingPlayerList(){if(document.contains(document.getElementsByName("player")[0])){document.getElementById("players").innerHTML=""}}function createExchangeButtons(b){numberOfExchangeButtons=numberOfExchangeButtons+1;var e=document.createElement("div");e.setAttribute("class","row");var c=document.createElement("button");c.setAttribute("type","button");c.setAttribute("class","btn btn-default exchange");c.setAttribute("name",numberOfExchangeButtons);c.addEventListener("click",function(){var f=this.name;exchangePlayer(f)});var d=document.createElement("span");d.setAttribute("class","glyphicon glyphicon-sort");d.setAttribute("aria-hidden","true");var a=document.createElement("br");c.appendChild(d);e.appendChild(c);b.appendChild(e);b.appendChild(a)}function removeExchangeButtons(){var e=document.getElementsByTagName("br").length;for(var b=4;b<e;b++){var a=document.getElementsByTagName("br")[4];a.parentNode.removeChild(a)}var c=document.getElementsByClassName("exchange").length;for(var b=0;b<c;b++){var d=document.getElementsByClassName("exchange")[0];d.parentNode.removeChild(d)}}function exchangePlayer(c){var b="";var a="";b=document.getElementsByName("playerName")[(c-1)].innerHTML;a=document.getElementsByName("playerName")[c].innerHTML;document.getElementsByName("playerName")[(c-1)].innerHTML=a;document.getElementsByName("playerName")[c].innerHTML=b}function roundToTwo(a){return +(Math.round(a+"e+2")+"e-2")};