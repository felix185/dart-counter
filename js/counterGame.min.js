function parseFromSessionStorage(a){return JSON.parse(window.sessionStorage.getItem(a))}function clearSessionStorage(){return window.sessionStorage.clear()}function init(){0===sessionStorage.length&&(window.location.href="./counterSettings.html");var a;startNumber=parseFromSessionStorage("startNumber"),doubleOut=parseFromSessionStorage("doubleOut"),players=parseFromSessionStorage("players"),null==startNumber&&null==doubleOut?(startNumber=501,doubleOut=!0):null==doubleOut?doubleOut=!0:null==startNumber&&(startNumber=501),a=1==doubleOut?"Double Out":"Single Out",numberOfPlayers=players.length,document.getElementById("startnumber").innerText=startNumber,document.getElementById("out").innerText=a,document.getElementById("currentRound").innerText=playedRounds,createPlayerList(),fillNamesInList(),createTable(),document.getElementsByName("player")[0].style.opacity=1,document.getElementById("score").focus(),document.getElementById("restart").click()}function createPlayerList(){for(var a=document.getElementById("players"),b=0;b<players.length;b++){var c=document.createElement("div");c.className="panel panel-default",c.setAttribute("name","player");var d=document.createElement("div");d.className="panel-heading",d.setAttribute("name","playerName");var e=document.createElement("div");e.className="panel-body";var f=document.createElement("p");f.setAttribute("name","playerScore");var g=document.createElement("p");g.innerHTML="Average: ";var h=document.createElement("span");h.setAttribute("name","avg"),g.appendChild(h),e.appendChild(f),e.appendChild(g),c.appendChild(d),c.appendChild(e),a.appendChild(c),b+1!==players.length&&createExchangeButtons(a)}}function fillNamesInList(){for(var a=0;a<players.length;a++)document.getElementsByName("playerName")[a].innerHTML=players[a],document.getElementsByName("playerScore")[a].innerHTML=startNumber,document.getElementsByName("player")[a].style.opacity=.5}function isInt(a){return!isNaN(a)&&parseInt(Number(a))==a&&!isNaN(parseInt(a,10))&&a>=0}function nextPlayer(){document.getElementsByName("player")[currentPlayer].style.opacity=.5,currentPlayer<document.getElementsByName("player").length-1?(currentPlayer+=1,document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial"):(currentPlayer=0,playedRounds+=1,document.getElementById("currentRound").innerText=playedRounds,document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial")}function undo(){0==currentPlayer?playedRounds-1<=0?alert("Don't abuse the Undo Button!"):(playedRounds-=1,document.getElementsByName("player")[currentPlayer].style.opacity=.5,currentPlayer=numberOfPlayers-1,document.getElementById("currentRound").innerText=playedRounds,document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial",document.getElementsByName("playerScore")[currentPlayer].innerHTML=oldScore,document.getElementsByName("avg")[currentPlayer].innerHTML=oldAvg,document.getElementById("score").focus()):(document.getElementsByName("player")[currentPlayer].style.opacity=.5,currentPlayer-=1,document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial",document.getElementsByName("playerScore")[currentPlayer].innerHTML=oldScore,document.getElementsByName("avg")[currentPlayer].innerHTML=oldAvg)}function undoLastHasWon(){numberOfPlayers+=1;var a=document.getElementById("players"),b=document.createElement("div");b.className="panel panel-default",b.setAttribute("name","player");var c=document.createElement("div");c.className="panel-heading",c.setAttribute("name","playerName"),c.innerHTML=nameLastWon;var d=document.createElement("div");d.className="panel-body";var e=document.createElement("p");e.setAttribute("name","playerScore"),e.innerHTML=oldScore;var f=document.createElement("p");f.innerHTML="Average: ";var g=document.createElement("span");if(g.setAttribute("name","avg"),g.innerHTML=oldAvg,f.appendChild(g),d.appendChild(e),d.appendChild(f),b.appendChild(c),b.appendChild(d),1==players.length)currentPlayer=0,playedRounds-=1,document.getElementById("currentRound").innerText=playedRounds,a.appendChild(b),document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial",numberOfWinners-=1,document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="",document.getElementsByName("average")[numberOfWinners].innerHTML="";else if(numberOfWinners==players.length){var h=b.cloneNode(!0);a.appendChild(b),a.appendChild(h),0==numberPlayerHasWon?(document.getElementsByName("playerName")[1].innerHTML=nameLost,document.getElementsByName("playerScore")[1].innerHTML=oldScoreLast,document.getElementsByName("avg")[1].innerHTML=avgLost,document.getElementsByName("player")[1].style.opacity=.5,currentPlayer=0):(document.getElementsByName("playerName")[0].innerHTML=nameLost,document.getElementsByName("playerScore")[0].innerHTML=oldScoreLast,document.getElementsByName("avg")[0].innerHTML=avgLost,document.getElementsByName("player")[0].style.opacity=.5,currentPlayer=1,playedRounds-=1,document.getElementById("currentRound").innerText=playedRounds),document.getElementsByName("player")[currentPlayer].style.opacity=1,numberOfWinners-=1,document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="",document.getElementsByName("average")[numberOfWinners].innerHTML="",numberOfWinners-=1,document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="",document.getElementsByName("average")[numberOfWinners].innerHTML=""}else document.getElementsByName("player")[currentPlayer].style.opacity=.5,numberPlayerHasWon===numberOfPlayers-1?(currentPlayer=numberOfPlayers-1,playedRounds-=1,document.getElementById("currentRound").innerText=playedRounds,a.appendChild(b),document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial"):(a.insertBefore(b,a.childNodes[currentPlayer]),document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial"),numberOfWinners-=1,document.getElementsByName("nameWinner")[numberOfWinners].innerHTML="",document.getElementsByName("average")[numberOfWinners].innerHTML=""}function removePlayer(){var a=document.getElementsByName("player")[currentPlayer];if(a.parentNode.removeChild(a),currentPlayer===document.getElementsByName("player").length&&(currentPlayer=0,playedRounds+=1,document.getElementById("currentRound").innerText=playedRounds),document.getElementsByName("player").length>1&&(document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial"),1===document.getElementsByName("player").length){var b=document.getElementsByName("avg")[currentPlayer].innerHTML;oldScoreLast=document.getElementsByName("playerScore")[currentPlayer].innerHTML,nameLost=document.getElementsByName("playerName")[currentPlayer].innerHTML,avgLost=b,addPlayerToTable(b),a=document.getElementsByName("player")[currentPlayer],a.parentNode.removeChild(a),numberOfPlayers-=1}}function addPlayerToTable(a){var b=document.getElementsByName("playerName")[currentPlayer].innerHTML;document.getElementsByName("nameWinner")[numberOfWinners].innerHTML=b,document.getElementsByName("average")[numberOfWinners].innerHTML=a,numberOfWinners+=1}function createTable(){for(var a=document.getElementById("table"),b=1;b<=players.length;b++){var c=document.createElement("tr"),d=document.createElement("td"),e=document.createTextNode(b);d.appendChild(e);var f=document.createElement("td");f.setAttribute("name","nameWinner");var g=document.createElement("td");g.setAttribute("name","average"),c.appendChild(d),c.appendChild(f),c.appendChild(g),a.appendChild(c)}}function clearRemainingPlayerList(){document.contains(document.getElementsByName("player")[0])&&(document.getElementById("players").innerHTML="")}function createExchangeButtons(a){numberOfExchangeButtons+=1;var b=document.createElement("div");b.setAttribute("class","row");var c=document.createElement("button");c.setAttribute("type","button"),c.setAttribute("class","btn btn-default exchange"),c.setAttribute("name",numberOfExchangeButtons),c.addEventListener("click",function(){var a=this.name;exchangePlayer(a)});var d=document.createElement("span");d.setAttribute("class","glyphicon glyphicon-sort"),d.setAttribute("aria-hidden","true");var e=document.createElement("br");c.appendChild(d),b.appendChild(c),a.appendChild(b),a.appendChild(e)}function removeExchangeButtons(){for(var a=document.getElementsByTagName("br").length,b=4;b<a;b++){var c=document.getElementsByTagName("br")[4];c.parentNode.removeChild(c)}for(var d=document.getElementsByClassName("exchange").length,b=0;b<d;b++){var e=document.getElementsByClassName("exchange")[0];e.parentNode.removeChild(e)}}function exchangePlayer(a){var b="",c="";b=document.getElementsByName("playerName")[a-1].innerHTML,c=document.getElementsByName("playerName")[a].innerHTML,document.getElementsByName("playerName")[a-1].innerHTML=c,document.getElementsByName("playerName")[a].innerHTML=b}function roundToTwo(a){return+(Math.round(a+"e+2")+"e-2")}var startNumber=501,doubleOut=!0,players=new Array,currentPlayer=0,numberOfWinners=0,numberOfExchangeButtons=0,playedRounds=1,oldScore=0,oldAvg=0,timesOfUndo=0,numberOfPlayers=0,hasLastWon=!1,nameLastWon="",numberPlayerHasWon=null,nameLost="",avgLost=0,oldScoreLast=0;document.getElementById("score").addEventListener("keyup",function(a){a.preventDefault(),13==a.keyCode&&document.getElementById("next").click()}),$(".number").on("click",function(){var a=$(this)[0].firstChild.nodeValue;document.getElementById("score").value+=a}),$("#rmv").on("click",function(){var a=document.getElementById("score").value;document.getElementById("score").value=a.substring(0,a.length-1)}),$("#quit").on("click",function(){clearSessionStorage(),window.location.href="./counterSettings.html"}),$("#restart").on("click",function(){currentPlayer=0,numberOfWinners=0,numberOfExchangeButtons=0,playedRounds=1,oldScore=0,oldAvg=0,timesOfUndo=0,numberPlayerHasWon=null,hasLastWon=!1,numberOfPlayers=players.length,document.getElementById("score").value="",clearRemainingPlayerList(),createPlayerList(),fillNamesInList();for(var a=0;a<players.length;a++)document.getElementsByName("avg")[a].innerHTML="",document.getElementsByName("playerScore")[a].innerHTML=startNumber,document.getElementsByName("player")[a].style.opacity=.5,document.getElementsByName("nameWinner")[a].innerHTML="",document.getElementsByName("average")[a].innerHTML="";document.getElementsByName("player")[0].style.opacity=1,document.getElementsByName("avg")[0].style.display="initial",document.getElementById("score").focus(),document.getElementById("currentRound").innerText=playedRounds}),$("#next").on("click",function(){timesOfUndo=0,hasLastWon=!1;var a=document.getElementById("score").value;if(""==a&&(a=0),isInt(a))if(a>180)alert("Please enter a score of 180 or less.");else if(0===document.getElementsByName("player").length)alert("Please start a new Game!");else try{document.getElementById("score").value="";var b=document.getElementsByName("playerScore")[currentPlayer].innerHTML;oldAvg=document.getElementsByName("avg")[currentPlayer].innerHTML,oldScore=b;var c=b-a;if(c<0){var d=roundToTwo((startNumber-b)/playedRounds);document.getElementsByName("avg")[currentPlayer].innerHTML=d,nextPlayer()}else if(1===c&&doubleOut){var d=roundToTwo((startNumber-b)/playedRounds);document.getElementsByName("avg")[currentPlayer].innerHTML=d,nextPlayer()}else if(0===c){var e=roundToTwo(startNumber/playedRounds);hasLastWon=!0,nameLastWon=document.getElementsByName("playerName")[currentPlayer].innerHTML,numberPlayerHasWon=currentPlayer,addPlayerToTable(e),removePlayer(),numberOfPlayers-=1}else{document.getElementsByName("playerScore")[currentPlayer].innerHTML=c;var d=roundToTwo((startNumber-c)/playedRounds);document.getElementsByName("avg")[currentPlayer].innerHTML=d,removeExchangeButtons(),nextPlayer()}}catch(a){alert("An error occured. Player 1 to throw now. Sorry for any inconvenience caused."),console.log(a),document.getElementsByName("player")[currentPlayer].style.opacity=.5,currentPlayer=0,document.getElementsByName("player")[currentPlayer].style.opacity=1,document.getElementsByName("avg")[currentPlayer].style.display="initial"}else alert("Please enter a natural number.")}),$("#undo").on("click",function(){0!=timesOfUndo?alert("Only one time 'Undo' allowed!"):(hasLastWon?undoLastHasWon():undo(),timesOfUndo=1,document.getElementById("score").focus())});